<div class="quiz-container">
  <div>
    <h1>{{ quiz$()?.name }}</h1>

    <p>Question {{ (index$() ?? 0) + 1 }}</p>

    @if (question$()?.type === questionElement.Letter) {
      <p>
        <span>{{ question$()?.vowel?.letter }}</span> (<span
          class="symbol-name"
          >{{ question$()?.vowel?.symbol?.names?.join(', ') | lowercase }}</span
        >)
      </p>
    } @else if (question$()?.type === questionElement.Name) {
      <p>{{ question$()?.vowel?.name }}</p>
    } @else if (question$()?.type === questionElement.Sound) {
      <button
        mat-icon-button
        matRipple
        (click)="$event.preventDefault(); audio.play()"
      >
        <ng-icon name="lucideCirclePlay"></ng-icon>
      </button>
      <audio
        #audio
        src="/vowel_audio/{{ question$()?.vowel?.audio?.file }}"
      ></audio>
    } @else {
      <span>ERROR:</span>
      <code>{{ question$()?.type }}</code>
      <code>{{ typeof question$() }}</code>
    }

    <mat-radio-group
      class="d-flex flex-column"
      [value]="selectedAnswer$()"
      (change)="selectAnswer($event)"
    >
      @for (option of question$()?.options; track $index) {
        <mat-radio-button
          color="primary"
          [disabled]="answered$()"
          [disabledInteractive]="true"
          [ngClass]="{
            border:
              answered$() &&
              (selectedAnswer$() === option.id ||
                question$()?.vowel?.id === option.id),
            'border-danger':
              selectedAnswer$() === option.id &&
              question$()?.vowel?.id !== option.id,
            'border-success': option.id === question$()?.vowel?.id,
          }"
          [value]="option.id"
        >
          @if (option.type === questionElement.Letter) {
            {{ option.letter }}
          } @else if (option.type === questionElement.Name) {
            {{ option.name }}
          } @else if (option.type === questionElement.Sound) {
            <button
              mat-icon-button
              matRipple
              (click)="$event.preventDefault(); audio.play()"
            >
              <ng-icon name="lucideCirclePlay"></ng-icon>
            </button>
            <audio #audio src="vowel_audio/{{ option.audio.file }}"></audio>
          } @else {
            <span>ERROR</span>
          }
        </mat-radio-button>
      }
    </mat-radio-group>

    <button
      color="primary"
      mat-raised-button
      [disabled]="index$() === 0"
      (click)="previous()"
    >
      Previous
    </button>

    @if (!finished$()) {
      <button
        mat-raised-button
        [color]="answered$() ? 'primary' : 'warn'"
        [disabled]="
          !selectedAnswer$() ||
          (answered$() && index$() === (questionsLength$() ?? 0) - 1)
        "
        (click)="answered$() ? next() : verify()"
      >
        {{ answered$() ? 'Next' : 'Verify' }}
      </button>
    }

    @if (finished$()) {
      <button color="warn" mat-raised-button (click)="newSession()">
        New Session
      </button>
    }
  </div>

  <app-chart
    [answered]="answered$()"
    [question]="question$()"
    [selectedAnswer]="selectedAnswer$()"
  ></app-chart>
</div>
